
;; -- Header ------------------------------------------------------------------
;; ----------------------------------------------------------------------------

; Author: bithandshake
; Created: 2021.01.01
; Description:
; Version: v0.4.0
; Compatibility: x4.5.2



;; -- Namespace ---------------------------------------------------------------
;; ----------------------------------------------------------------------------

(ns x.server-environment.crawler-handler
    (:require [mid-fruits.uri     :as uri]
              [mid-fruits.time    :as time]
              [server-fruits.http :as http]
              [x.app-details      :as details]
              [x.server-core.api  :as a]))



;; ----------------------------------------------------------------------------
;; ----------------------------------------------------------------------------

(defn- robots-txt
  ; WARNING! NON-PUBLIC! DO NOT USE!
  ;
  ; @param (string) app-home
  ;
  ; @return (string)
  [app-home]
  (let [app-home  (uri/valid-path app-home)
        timestamp (time/timestamp-string)]
       (str "\n# Generated by: " details/app-codename
            "\n# Generated at: " timestamp "\n"
            "\nUser-agent: *\nAllow: /\nDisallow: " app-home "\n")))

(defn download-robots-txt
  ; WARNING! NON-PUBLIC! DO NOT USE!
  ;
  ; @param (map) request
  ;
  ; @return (map)
  ;  {:body (string)}
  [_]
  (let [app-home   (a/subscribed [:core/get-app-config-item :app-home])
        robots-txt (robots-txt app-home)]
       (http/text-wrap {:body robots-txt})))
